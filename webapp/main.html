<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¾Šæ°è®°è´¦</title>

    <!-- ç²¾ç®€ä¾èµ– -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ’°</text></svg>">

    <style>
        /* ========== åŸºç¡€é‡ç½® ========== */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Microsoft YaHei', sans-serif;
            background: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }

        /* ========== é¡¶éƒ¨å¯¼èˆª ========== */
        .navbar {
            background: linear-gradient(135deg, #4CAF50 0%, #2E7D32 100%);
            color: white;
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-info {
            font-size: 14px;
            opacity: 0.9;
        }

        .logout-btn {
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
        }

        .logout-btn:hover { background: rgba(255,255,255,0.3); }
        /* ========== ä¸»æ ‡é¢˜ ========== */
        .main-title {
            text-align: center;
            padding: 30px 0 20px;
            color: #2c3e50;
        }

        .main-title h1 {
            font-size: 36px;
            font-weight: bold;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #4CAF50 0%, #2196F3 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .main-title p {
            color: #7f8c8d;
            font-size: 16px;
            max-width: 600px;
            margin: 0 auto;
        }

        /* ========== ä¸»å®¹å™¨ ========== */
        .container{
            max-width: 1000px;
            margin: 0 auto;
            padding: 0 20px 40px;
        }

        /* ========== ä¸»å®¹å™¨ ========== */
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }

        /* ========== ç»Ÿè®¡å¡ç‰‡ ========== */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }

        .stat-label {
            color: #666;
            font-size: 14px;
            margin-bottom: 10px;
        }

        .stat-value {
            font-size: 32px;
            font-weight: bold;
            font-family: 'Courier New', monospace;
        }

        .income { color: #4CAF50; }
        .expense { color: #F44336; }
        .balance { color: #2196F3; }

        /* ========== è®°è´¦è¡¨å• ========== */
        .record-form {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            margin: 25px 0;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group { margin-bottom: 15px; }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #555;
            font-size: 14px;
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .form-control:focus {
            outline: none;
            border-color: #4CAF50;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #4CAF50;
            color: white;
        }

        .btn-primary:hover {
            background: #388E3C;
            transform: translateY(-2px);
        }

        /* ========== è®°å½•åˆ—è¡¨ ========== */
        .records-list {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            overflow: hidden;
            margin: 25px 0;
        }

        .records-header {
            padding: 20px;
            border-bottom: 1px solid #eee;
        }

        .record-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 18px 20px;
            border-bottom: 1px solid #f5f5f5;
        }

        .record-item:hover { background: #f9f9f9; }

        .record-type {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 18px;
        }

        .income-type { background: #4CAF50; }
        .expense-type { background: #F44336; }

        .record-info {
            flex: 1;
            margin: 0 20px;
        }

        .record-category {
            font-weight: 500;
            color: #333;
            margin-bottom: 5px;
        }

        .record-meta {
            font-size: 13px;
            color: #888;
        }

        .record-amount {
            font-size: 20px;
            font-weight: 600;
            font-family: 'Courier New', monospace;
            min-width: 120px;
            text-align: right;
        }

        .delete-btn {
            background: none;
            border: none;
            color: #888;
            cursor: pointer;
            padding: 8px;
            font-size: 18px;
            transition: color 0.3s;
        }

        .delete-btn:hover { color: #F44336; }

        /* ========== å›¾è¡¨åŒºåŸŸ ========== */
        .chart-container {
            background: white;/*èƒŒæ™¯å›¾ä¸ºç™½è‰²*/
            padding: 25px;/*å†…è¾¹è·*/
            border-radius: 12px;/*åœ†è§’*/
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);/*é˜´å½±*/
            margin: 25px 0;/*ç¡®ä¿ä¸Šä¸‹æœ‰è¾¹è·*/
        }
        .charts-grid{
            display: grid;/*ç½‘ç»œå¸ƒå±€*/
            grid-template-columns: repeat(auto-fit,minmax(350px , 1fr));/*å“åº”åºåˆ—*/
            gap: 25px;/*å›¾è¡¨é—´è·*/
        }
        .chart-container{
            background: #f9f9f9;/*æµ…ç°è‰²èƒŒæ™¯*/
            padding: 20px;/*å†…è¾¹è·*/
            border-radius: 10px;/*åœ†è§’*/
            border: 1px solid #eee;/*è¾¹æ¡†*/
            height: 100%;/*é«˜åº¦100%*/
        }

        /* ========== åˆ†é¡µæ§ä»¶ ========== */
        .pagination-controls {
            display: flex; /* å¼¹æ€§å¸ƒå±€ */
            align-items: center; /* å‚ç›´å±…ä¸­ */
            gap: 5px; /* æ§ä»¶é—´è· */
        }

        .pagination-btn {
            background: #f5f5f5; /* èƒŒæ™¯è‰² */
            border: 1px solid #ddd; /* è¾¹æ¡† */
            border-radius: 5px; /* åœ†è§’ */
            width: 36px; /* å®½åº¦ */
            height: 36px; /* é«˜åº¦ */
            display: flex; /* å¼¹æ€§å¸ƒå±€ */
            align-items: center; /* å‚ç›´å±…ä¸­ */
            justify-content: center; /* æ°´å¹³å±…ä¸­ */
            cursor: pointer; /* æ‰‹å‹å…‰æ ‡ */
            transition: all 0.3s; /* è¿‡æ¸¡æ•ˆæœ */
            font-size: 13px; /* å­—ä½“å¤§å° */
            color: #555; /* æ–‡å­—é¢œè‰² */
            font-weight: 500; /* å­—ä½“ç²—ç»† */
            min-width: 60px; /* æœ€å°å®½åº¦ï¼Œç¡®ä¿æŒ‰é’®æœ‰è¶³å¤Ÿç©ºé—´ */
        }

        .pagination-btn:hover {
            background: #4CAF50; /* æ‚¬åœèƒŒæ™¯è‰² */
            color: white; /* æ‚¬åœæ–‡å­—é¢œè‰² */
            border-color: #4CAF50; /* æ‚¬åœè¾¹æ¡†é¢œè‰² */
        }

        .pagination-btn:disabled {
            opacity: 0.5; /* ç¦ç”¨æ—¶åŠé€æ˜ */
            cursor: not-allowed; /* ç¦ç”¨å…‰æ ‡ */
        }

        .pagination-btn:disabled:hover {
            background: #f5f5f5; /* ç¦ç”¨æ‚¬åœèƒŒæ™¯ */
            color: inherit; /* ç¦ç”¨æ‚¬åœæ–‡å­—é¢œè‰² */
            border-color: #ddd; /* ç¦ç”¨æ‚¬åœè¾¹æ¡† */
        }

        #pageInfo {
            font-size: 14px; /* å­—ä½“å¤§å° */
            color: #666; /* æ–‡å­—é¢œè‰² */
            min-width: 60px; /* æœ€å°å®½åº¦ */
            text-align: center; /* å±…ä¸­ */
            margin: 0 10px;/*å·¦å³é—´è·*/
        }

        /* ========== å“åº”å¼è®¾è®¡ ========== */
        @media (max-width: 768px) {
           .charts-grid{
               grid-template-columns: 1fr;/*å°å±å¹•å•åˆ—æ˜¾ç¤º*/
               gap: 20px;/*å‡å°‘è¾¹è·*/
           }
            .chart-container{
                padding: 15px;/*å‡å°‘å†…è¾¹è·*/
            }
            #incomeChart,#expenseChart{
                height: 220px !important;/*è°ƒæ•´å›¾è¡¨é«˜åº¦*/
            }
        }

        /* ========== ç©ºçŠ¶æ€ ========== */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #888;
        }

        /* ========== åŠ è½½çŠ¶æ€ ========== */
        .loading {
            text-align: center;
            padding: 40px;
            color: #4CAF50;
        }

        .loading-spinner {
            display: inline-block;
            width: 30px;
            height: 30px;
            border: 3px solid rgba(76, 175, 80, 0.3);
            border-top: 3px solid #4CAF50;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>

<!-- é¡¶éƒ¨å¯¼èˆª -->
<nav class="navbar">
    <div class="logo">
        <i class="fas fa-coins"></i>
        <span>ç¾Šæ°è®°è´¦</span>
    </div>
    <div class="user-info" id="welcomeMessage">åŠ è½½ä¸­...</div>
    <button class="logout-btn" onclick="logout()">
        <i class="fas fa-sign-out-alt"></i> é€€å‡º
    </button>
</nav>

<!-- ä¸»å†…å®¹ -->
<div class="container">
        <!-- ä¸»æ ‡é¢˜ -->
        <div class="main-title">
            <h1>ç¾Šæ°è®°è´¦ç®¡ç†ç³»ç»Ÿ</h1>
            <p>è½»æ¾ç®¡ç†æ‚¨çš„æ¯ä¸€ç¬”æ”¶æ”¯ï¼Œè®©è´¢åŠ¡ç®¡ç†æ›´ç®€å•</p>
        </div>

    <!-- ç»Ÿè®¡å¡ç‰‡ -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-label">æ€»æ”¶å…¥</div>
            <div class="stat-value income" id="totalIncome">Â¥ 0.00</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">æ€»æ”¯å‡º</div>
            <div class="stat-value expense" id="totalExpense">Â¥ 0.00</div>
        </div>
        <div class="stat-card">
            <div class="stat-label">å½“å‰ä½™é¢</div>
            <div class="stat-value balance" id="totalBalance">Â¥ 0.00</div>
        </div>
    </div>

    <!-- è®°è´¦è¡¨å• -->
    <div class="record-form">
        <h2 style="margin-bottom: 20px;">æ·»åŠ è®°å½•</h2>
        <div class="form-grid">
            <div class="form-group">
                <label class="form-label">ç±»å‹</label>
                <select id="recordType" class="form-control">
                    <option value="income">æ”¶å…¥</option>
                    <option value="expense" selected>æ”¯å‡º</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">é‡‘é¢ (Â¥)</label>
                <input type="number" id="amount" class="form-control" placeholder="0.00" step="0.01" min="0">
            </div>
            <div class="form-group">
                <label class="form-label">åˆ†ç±»</label>
                <select id="category" class="form-control">
                    <option value="food">é¤é¥®</option>
                    <option value="transport">äº¤é€š</option>
                    <option value="shopping">è´­ç‰©</option>
                    <option value="housing">ä½æˆ¿</option>
                    <option value="entertainment">å¨±ä¹</option>
                    <option value="salary">å·¥èµ„</option>
                    <option value="investment">æŠ•èµ„</option>
                    <option value="other">å…¶ä»–</option>
                </select>
            </div>
        </div>
        <div class="form-grid">
            <div class="form-group">
                <label class="form-label">æ—¥æœŸ</label>
                <input type="date" id="recordDate" class="form-control">
            </div>
            <div class="form-group">
                <label class="form-label">å¤‡æ³¨</label>
                <input type="text" id="description" class="form-control" placeholder="å¤‡æ³¨ï¼ˆå¯é€‰ï¼‰">
            </div>
            <div class="form-group" style="display: flex; align-items: flex-end;">
                <button class="btn btn-primary" onclick="addRecord()" style="width: 100%;">
                    <i class="fas fa-plus"></i> æ·»åŠ è®°å½•
                </button>
            </div>
        </div>
    </div>

    <!-- è®°å½•åˆ—è¡¨ -->
    <div class="records-list">
        <div class="records-header" style="display: flex;justify-content: space-between;align-items: center;">
            <div style="display: flex;align-items: center;gap: 15px;">
            <h2 style="margin: 0;">æœ€è¿‘è®°å½•</h2>
                <!--æœç´¢æ¡†-->
                <div style="display: flex; align-items: center; position: relative;">
                    <input type="text" id="searchInput" placeholder="æœç´¢å¤‡æ³¨..."
                           style="width: 160px; padding: 6px 30px 6px 12px; border: 1px solid #ddd; border-radius: 16px; font-size: 13px; background: #f9f9f9; transition: all 0.3s;"
                           onkeyup="handleSearchInput(event)"
                           onfocus="this.style.width='200px'; this.style.background='white'; this.style.borderColor='#4CAF50';"
                           onblur="this.style.width='160px'; this.style.background='#f9f9f9'; this.style.borderColor='#ddd';">
                    <button onclick="performSearch()"
                            style="position: absolute; right: 6px; background: none; border: none; color: #888; cursor: pointer; padding: 4px;"
                            onmouseover="this.style.color='#4CAF50'"
                            onmouseout="this.style.color='#888'">
                        <i class="fas fa-search" style="font-size: 12px;"></i>
                    </button>
                </div>
            </div>

            <div class="pagination-controls">
                <button class="pagination-btn" onclick="prevPage()" id="prevBtn" disabled>
                    ä¸Šä¸€é¡µ
                </button>
                <span id="pageInfo" style="margin: 0 10px;">ç¬¬1é¡µ</span>
                <button class ="pagination-btn" onclick="nextPage()" id="nextBtn">
                    ä¸‹ä¸€é¡µ
                </button>
            </div>
        </div>
        <div id="recordsContainer">
            <div class="empty-state">
                <i class="fas fa-inbox" style="font-size: 48px; margin-bottom: 15px;"></i>
                <p>è¿˜æ²¡æœ‰è®°å½•ï¼Œæ·»åŠ ç¬¬ä¸€æ¡è®°å½•å§ï¼</p>
            </div>
        </div>
    </div>

    <!-- å›¾è¡¨åŒºåŸŸ -->
    <div class="charts-section">
        <h2 style="margin-bottom: 20px; text-align: center;">åˆ†ç±»ç»Ÿè®¡</h2>

        <div class="charts-grid">
            <!-- æ”¶å…¥å›¾è¡¨ -->
            <div class="chart-container">
                <h3 style="margin-bottom: 15px; color: #4CAF50;">æ”¶å…¥åˆ†ç±»</h3>
                <canvas id="incomeChart" style="width: 100%; height: 250px;"></canvas>
            </div>

            <!-- æ”¯å‡ºå›¾è¡¨ -->
            <div class="chart-container">
                <h3 style="margin-bottom: 15px; color: #F44336;">æ”¯å‡ºåˆ†ç±»</h3>
                <canvas id="expenseChart" style="width: 100%; height: 250px;"></canvas>
                </div>
            </div>
        </div>
    </div>

<!-- å¼•å…¥Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
    // ========== æ ¸å¿ƒåŠŸèƒ½è„šæœ¬ ==========
    let records = [];
    let currentUser = null;
    let chartInstance = null;

    // åˆå§‹åŒ–é¡µé¢
    document.addEventListener('DOMContentLoaded', function() {
        // è®¾ç½®é»˜è®¤æ—¥æœŸ
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('recordDate').value = today;

        // æ£€æŸ¥ç™»å½•çŠ¶æ€
        checkLoginStatus();

        // åŠ è½½æ•°æ®
        loadData();
    });

    // æ£€æŸ¥ç™»å½•çŠ¶æ€
    function checkLoginStatus() {
        const userData = localStorage.getItem('currentUser');
        if (!userData) {
            window.location.href = 'index.html';
            return;
        }

        try {
            currentUser = JSON.parse(userData);
            document.getElementById('welcomeMessage').textContent =
                `æ¬¢è¿ï¼Œ${currentUser.username}`;
        } catch (e) {
            window.location.href = 'index.html';
        }
    }

    // åŠ è½½æ•°æ®
    function loadData() {
        if (!currentUser) return;//ç”¨æˆ·ä¸å­˜åœ¨å°±è¿”å›

        const storageKey = currentUser.username === 'guest'//æ ¹æ®ç”¨æˆ·ç±»å‹ç¡®å®šå­˜å‚¨é”®
            ? 'guestAccountingData'
            : `accountingData_${currentUser.username}`;

        const data = localStorage.getItem(storageKey);//ä»æœ¬åœ°å­˜å‚¨è·å–æ•°æ®
        records = data ? JSON.parse(data) : [];//è§£ææ•°æ®æˆ–åˆå§‹åŒ–ä¸ºç©ºæ•°ç»„
        currentPage = 1;//æ¯æ¬¡åŠ è½½æ•°æ®æ—¶é‡ç½®ä¸ºç¬¬ä¸€é¡µ

        updateDisplay();//æ›´æ–°æ˜¾ç¤ºå›¾è¡¨
    }

    // ä¿å­˜æ•°æ®
    function saveData() {
        if (!currentUser) return;

        const storageKey = currentUser.username === 'guest'
            ? 'guestAccountingData'
            : `accountingData_${currentUser.username}`;

        localStorage.setItem(storageKey, JSON.stringify(records));
    }

    // æ·»åŠ è®°å½•
    function addRecord() {
        const type = document.getElementById('recordType').value;
        const amount = parseFloat(document.getElementById('amount').value);
        const category = document.getElementById('category').value;
        const date = document.getElementById('recordDate').value;
        const description = document.getElementById('description').value.trim();

        // éªŒè¯
        if (!amount || amount <= 0) {
            alert('è¯·è¾“å…¥æœ‰æ•ˆçš„é‡‘é¢');
            return;
        }

        if (!date) {
            alert('è¯·é€‰æ‹©æ—¥æœŸ');
            return;
        }

        // åˆ›å»ºè®°å½•
        const record = {
            id: Date.now(),
            type: type,
            amount: amount,
            category: category,
            date: date,
            description: description,
            timestamp: new Date().toISOString()
        };

        records.unshift(record);
        saveData();

        // æ¸…ç©ºè¡¨å•
        document.getElementById('amount').value = '';
        document.getElementById('description').value = '';

        // æ›´æ–°æ˜¾ç¤º
        updateDisplay();

        alert('è®°å½•æ·»åŠ æˆåŠŸï¼');
    }

    // åˆ é™¤è®°å½•
    function deleteRecord(id) {
        if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡è®°å½•å—ï¼Ÿ')) return;

        records = records.filter(record => record.id !== id);
        saveData();
        updateDisplay();
    }

    // æ›´æ–°æ˜¾ç¤º
    function updateDisplay() {
       updateStatistics();//æ›´æ–°ç»Ÿè®¡æ•°æ®
       updateRecordList();//æ›´æ–°è®°å½•åˆ—è¡¨,ä»¥åŠåˆ†é¡µ
       updateIncomeChart();//æ›´æ–°æ”¶å…¥å›¾è¡¨
       updateExpenseChart();//æ›´æ–°æ”¯å‡ºå›¾è¡¨
    }

    // æ›´æ–°ç»Ÿè®¡
    function updateStatistics() {
        let totalIncome = 0;
        let totalExpense = 0;

        records.forEach(record => {
            if (record.type === 'income') {
                totalIncome += record.amount;
            } else {
                totalExpense += record.amount;
            }
        });

        const totalBalance = totalIncome - totalExpense;

        document.getElementById('totalIncome').textContent = `Â¥ ${totalIncome.toFixed(2)}`;
        document.getElementById('totalExpense').textContent = `Â¥ ${totalExpense.toFixed(2)}`;
        document.getElementById('totalBalance').textContent = `Â¥ ${totalBalance.toFixed(2)}`;
    }

    // æ›´æ–°è®°å½•åˆ—è¡¨
    function updateRecordList() {
        const container = document.getElementById('recordsContainer');

        if (records.length === 0) {
            container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-inbox" style="font-size: 48px; margin-bottom: 15px;"></i>
                        <p>è¿˜æ²¡æœ‰è®°å½•ï¼Œæ·»åŠ ç¬¬ä¸€æ¡è®°å½•å§ï¼</p>
                    </div>
                `;
            return;
        }

        const categoryNames = {
            'food': 'é¤é¥®', 'transport': 'äº¤é€š', 'shopping': 'è´­ç‰©',
            'housing': 'ä½æˆ¿', 'entertainment': 'å¨±ä¹', 'salary': 'å·¥èµ„',
            'investment': 'æŠ•èµ„', 'other': 'å…¶ä»–'
        };

        let html = '';
        const recent = records.slice(0, 15);

        recent.forEach(record => {
            const category = categoryNames[record.category] || record.category;
            const typeClass = record.type === 'income' ? 'income-type' : 'expense-type';
            const typeSign = record.type === 'income' ? '+' : '-';
            const amountColor = record.type === 'income' ? '#4CAF50' : '#F44336';

            html += `
                    <div class="record-item">
                        <div class="record-type ${typeClass}">
                            ${record.type === 'income' ? 'æ”¶' : 'æ”¯'}
                        </div>
                        <div class="record-info">
                            <div class="record-category">${category}</div>
                            <div class="record-meta">
                                ${record.date} ${record.description ? 'Â· ' + record.description : ''}
                            </div>
                        </div>
                        <div class="record-amount" style="color: ${amountColor}">
                            ${typeSign}Â¥ ${record.amount.toFixed(2)}
                        </div>
                        <button class="delete-btn" onclick="deleteRecord(${record.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
        });

        container.innerHTML = html;
    }

    let incomeChartInstance = null;//æ”¶å…¥å›¾è¡¨å®ä¾‹
    let expenseChartInstance = null;//æ”¯å‡ºå›¾è¡¨å®ä¾‹

    // æ›´æ–°æ”¶å…¥å›¾è¡¨
    function updateIncomeChart() {
        const ctx = document.getElementById('incomeChart').getContext('2d'); // è·å–æ”¶å…¥å›¾è¡¨canvasä¸Šä¸‹æ–‡

        // è®¡ç®—æ”¶å…¥åˆ†ç±»ç»Ÿè®¡
        const categoryTotals = {}; // åˆ†ç±»æ€»è®¡å¯¹è±¡
        records.forEach(record => { // éå†æ‰€æœ‰è®°å½•
            if (record.type === 'income') { // åªå¤„ç†æ”¶å…¥è®°å½•
                categoryTotals[record.category] = (categoryTotals[record.category] || 0) + record.amount; // ç´¯åŠ åˆ†ç±»é‡‘é¢
            }
        });

        const categories = Object.keys(categoryTotals); // è·å–åˆ†ç±»æ•°ç»„
        const amounts = Object.values(categoryTotals); // è·å–é‡‘é¢æ•°ç»„

        // å¤„ç†æ— æ•°æ®æƒ…å†µ
        if (categories.length === 0) {
            document.getElementById('incomeChart').parentElement.innerHTML = `
            <h2 style="margin-bottom: 20px;">æ”¶å…¥åˆ†ç±»ç»Ÿè®¡</h2>
            <div class="empty-state" style="padding: 20px;">
                <p>æš‚æ— æ”¶å…¥æ•°æ®</p>
            </div>
        `;
            return;
        }

        // é”€æ¯æ—§å›¾è¡¨
        if (incomeChartInstance) incomeChartInstance.destroy(); // é”€æ¯ä¹‹å‰çš„æ”¶å…¥å›¾è¡¨

        // åˆ›å»ºæ–°å›¾è¡¨
        incomeChartInstance = new Chart(ctx, { // åˆ›å»ºChart.jså®ä¾‹
            type: 'pie', // é¥¼å›¾ç±»å‹
            data: { // å›¾è¡¨æ•°æ®
                labels: categories.map(cat => ({ // æ˜ å°„åˆ†ç±»åç§°
                    'food': 'é¤é¥®', 'transport': 'äº¤é€š', 'shopping': 'è´­ç‰©',
                    'housing': 'ä½æˆ¿', 'entertainment': 'å¨±ä¹', 'salary': 'å·¥èµ„',
                    'investment': 'æŠ•èµ„', 'other': 'å…¶ä»–'
                })[cat] || cat),
                datasets: [{ // æ•°æ®é›†
                    data: amounts, // æ•°æ®å€¼
                    backgroundColor: [ // é¥¼å›¾é¢œè‰²æ•°ç»„
                        '#4CAF50', '#2196F3', '#FF9800', '#9C27B0',
                        '#00BCD4', '#FFC107', '#795548', '#607D8B'
                    ]
                }]
            },
            options: { // å›¾è¡¨é€‰é¡¹
                responsive: true, // å“åº”å¼è®¾è®¡
                plugins: { // æ’ä»¶é…ç½®
                    legend: { position: 'bottom' } // å›¾ä¾‹ä½ç½®
                }
            }
        });
    }

    // æ›´æ–°æ”¯å‡ºå›¾è¡¨
    function updateExpenseChart() {
        const ctx = document.getElementById('expenseChart').getContext('2d'); // è·å–æ”¯å‡ºå›¾è¡¨canvasä¸Šä¸‹æ–‡

        // è®¡ç®—æ”¯å‡ºåˆ†ç±»ç»Ÿè®¡
        const categoryTotals = {}; // åˆ†ç±»æ€»è®¡å¯¹è±¡
        records.forEach(record => { // éå†æ‰€æœ‰è®°å½•
            if (record.type === 'expense') { // åªå¤„ç†æ”¯å‡ºè®°å½•
                categoryTotals[record.category] = (categoryTotals[record.category] || 0) + record.amount; // ç´¯åŠ åˆ†ç±»é‡‘é¢
            }
        });

        const categories = Object.keys(categoryTotals); // è·å–åˆ†ç±»æ•°ç»„
        const amounts = Object.values(categoryTotals); // è·å–é‡‘é¢æ•°ç»„

        // å¤„ç†æ— æ•°æ®æƒ…å†µ
        if (categories.length === 0) {
            document.getElementById('expenseChart').parentElement.innerHTML = `
            <h2 style="margin-bottom: 20px;">æ”¯å‡ºåˆ†ç±»ç»Ÿè®¡</h2>
            <div class="empty-state" style="padding: 20px;">
                <p>æš‚æ— æ”¯å‡ºæ•°æ®</p>
            </div>
        `;
            return;
        }

        // é”€æ¯æ—§å›¾è¡¨
        if (expenseChartInstance) expenseChartInstance.destroy(); // é”€æ¯ä¹‹å‰çš„æ”¯å‡ºå›¾è¡¨

        // åˆ›å»ºæ–°å›¾è¡¨
        expenseChartInstance = new Chart(ctx, { // åˆ›å»ºChart.jså®ä¾‹
            type: 'pie', // é¥¼å›¾ç±»å‹
            data: { // å›¾è¡¨æ•°æ®
                labels: categories.map(cat => ({ // æ˜ å°„åˆ†ç±»åç§°
                    'food': 'é¤é¥®', 'transport': 'äº¤é€š', 'shopping': 'è´­ç‰©',
                    'housing': 'ä½æˆ¿', 'entertainment': 'å¨±ä¹', 'salary': 'å·¥èµ„',
                    'investment': 'æŠ•èµ„', 'other': 'å…¶ä»–'
                })[cat] || cat),
                datasets: [{ // æ•°æ®é›†
                    data: amounts, // æ•°æ®å€¼
                    backgroundColor: [ // é¥¼å›¾é¢œè‰²æ•°ç»„
                        '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0',
                        '#9966FF', '#FF9F40', '#8AC926', '#FF595E'
                    ]
                }]
            },
            options: { // å›¾è¡¨é€‰é¡¹
                responsive: true, // å“åº”å¼è®¾è®¡
                plugins: { // æ’ä»¶é…ç½®
                    legend: { position: 'bottom' } // å›¾ä¾‹ä½ç½®
                }
            }
        });
    }

    // ========== åˆ†é¡µç›¸å…³å˜é‡ ==========
    let currentPage = 1; // å½“å‰é¡µç 
    const recordsPerPage = 6; // æ¯é¡µæ˜¾ç¤º6æ¡è®°å½•

    // æ›´æ–°è®°å½•åˆ—è¡¨
    function updateRecordList() {
        const container = document.getElementById('recordsContainer'); // è·å–è®°å½•å®¹å™¨
        const pageInfo = document.getElementById('pageInfo'); // è·å–é¡µç ä¿¡æ¯å…ƒç´ 
        const prevBtn = document.getElementById('prevBtn'); // è·å–ä¸Šä¸€é¡µæŒ‰é’®
        const nextBtn = document.getElementById('nextBtn'); // è·å–ä¸‹ä¸€é¡µæŒ‰é’®

        if (records.length === 0) { // å¦‚æœæ²¡æœ‰è®°å½•
            container.innerHTML = `
            <div class="empty-state">
                <i class="fas fa-inbox" style="font-size: 48px; margin-bottom: 15px;"></i>
                <p>è¿˜æ²¡æœ‰è®°å½•ï¼Œæ·»åŠ ç¬¬ä¸€æ¡è®°å½•å§ï¼</p>
            </div>
        `;
            pageInfo.textContent = 'ç¬¬ 1 é¡µ'; // æ˜¾ç¤ºé»˜è®¤é¡µç 
            prevBtn.disabled = true; // ç¦ç”¨ä¸Šä¸€é¡µæŒ‰é’®
            nextBtn.disabled = true; // ç¦ç”¨ä¸‹ä¸€é¡µæŒ‰é’®
            return;
        }

        // è®¡ç®—æ€»é¡µæ•°
        const totalPages = Math.ceil(records.length / recordsPerPage); // è®¡ç®—æ€»é¡µæ•°
        if (currentPage > totalPages) currentPage = totalPages; // å¦‚æœå½“å‰é¡µç å¤§äºæ€»é¡µæ•°ï¼Œé‡ç½®ä¸ºæœ€åä¸€é¡µ
        if (currentPage < 1) currentPage = 1; // å¦‚æœå½“å‰é¡µç å°äº1ï¼Œé‡ç½®ä¸ºç¬¬ä¸€é¡µ

        // è®¡ç®—å½“å‰é¡µçš„è®°å½•èŒƒå›´
        const startIndex = (currentPage - 1) * recordsPerPage; // èµ·å§‹ç´¢å¼•
        const endIndex = Math.min(startIndex + recordsPerPage, records.length); // ç»“æŸç´¢å¼•
        const pageRecords = records.slice(startIndex, endIndex); // è·å–å½“å‰é¡µè®°å½•

        // æ›´æ–°é¡µç ä¿¡æ¯
        pageInfo.textContent = `ç¬¬ ${currentPage} / ${totalPages} é¡µ`; // æ˜¾ç¤ºé¡µç ä¿¡æ¯

        // æ›´æ–°æŒ‰é’®çŠ¶æ€
        prevBtn.disabled = currentPage === 1; // ç¬¬ä¸€é¡µæ—¶ç¦ç”¨ä¸Šä¸€é¡µæŒ‰é’®
        nextBtn.disabled = currentPage === totalPages; // æœ€åä¸€é¡µæ—¶ç¦ç”¨ä¸‹ä¸€é¡µæŒ‰é’®

        // ç”Ÿæˆå½“å‰é¡µçš„HTML
        const categoryNames = { // åˆ†ç±»åç§°æ˜ å°„
            'food': 'é¤é¥®', 'transport': 'äº¤é€š', 'shopping': 'è´­ç‰©',
            'housing': 'ä½æˆ¿', 'entertainment': 'å¨±ä¹', 'salary': 'å·¥èµ„',
            'investment': 'æŠ•èµ„', 'other': 'å…¶ä»–'
        };

        let html = ''; // HTMLå­—ç¬¦ä¸²
        pageRecords.forEach(record => { // éå†å½“å‰é¡µè®°å½•
            const category = categoryNames[record.category] || record.category; // è·å–åˆ†ç±»åç§°
            const typeClass = record.type === 'income' ? 'income-type' : 'expense-type'; // ç±»å‹æ ·å¼ç±»
            const typeSign = record.type === 'income' ? '+' : '-'; // ç±»å‹ç¬¦å·
            const amountColor = record.type === 'income' ? '#4CAF50' : '#F44336'; // é‡‘é¢é¢œè‰²

            html += `
            <div class="record-item">
                <div class="record-type ${typeClass}">
                    ${record.type === 'income' ? 'æ”¶' : 'æ”¯'}
                </div>
                <div class="record-info">
                    <div class="record-category">${category}</div>
                    <div class="record-meta">
                        ${record.date} ${record.description ? 'Â· ' + record.description : ''}
                    </div>
                </div>
                <div class="record-amount" style="color: ${amountColor}">
                    ${typeSign}Â¥ ${record.amount.toFixed(2)}
                </div>
                <button class="delete-btn" onclick="deleteRecord(${record.id})">
                    <i class="fas fa-trash"></i>
                </button>
            </div>
        `;
        });

        // æ·»åŠ é¡µç ä¿¡æ¯åˆ°åˆ—è¡¨åº•éƒ¨
        html += `
        <div class="pagination-footer" style="padding: 15px 20px; text-align: center; border-top: 1px solid #eee; color: #666; font-size: 14px;">
            æ˜¾ç¤º ${startIndex + 1}-${endIndex} æ¡ï¼Œå…± ${records.length} æ¡è®°å½•
        </div>
    `;

        container.innerHTML = html; // æ›´æ–°å®¹å™¨å†…å®¹
    }

    // ä¸Šä¸€é¡µå‡½æ•°
    function prevPage() {
        if (currentPage > 1) { // å¦‚æœä¸æ˜¯ç¬¬ä¸€é¡µ
            currentPage--; // é¡µç å‡ä¸€
            updateRecordList(); // æ›´æ–°è®°å½•åˆ—è¡¨
        }
    }

    // ä¸‹ä¸€é¡µå‡½æ•°
    function nextPage() {
        const totalPages = Math.ceil(records.length / recordsPerPage); // è®¡ç®—æ€»é¡µæ•°
        if (currentPage < totalPages) { // å¦‚æœä¸æ˜¯æœ€åä¸€é¡µ
            currentPage++; // é¡µç åŠ ä¸€
            updateRecordList(); // æ›´æ–°è®°å½•åˆ—è¡¨
        }
    }

    // åœ¨deleteRecordå‡½æ•°ä¸­é‡ç½®é¡µç 
    function deleteRecord(id) {
        if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡è®°å½•å—ï¼Ÿ')) return; // ç¡®è®¤åˆ é™¤

        records = records.filter(record => record.id !== id); // è¿‡æ»¤æ‰è¦åˆ é™¤çš„è®°å½•

        // å¦‚æœåˆ é™¤åå½“å‰é¡µæ²¡æœ‰è®°å½•ä¸”ä¸æ˜¯ç¬¬ä¸€é¡µï¼Œåˆ™è¿”å›ä¸Šä¸€é¡µ
        const totalPages = Math.ceil(records.length / recordsPerPage); // é‡æ–°è®¡ç®—æ€»é¡µæ•°
        if (currentPage > totalPages && currentPage > 1) { // å¦‚æœå½“å‰é¡µç å¤§äºæ€»é¡µæ•°ä¸”ä¸æ˜¯ç¬¬ä¸€é¡µ
            currentPage = totalPages; // è·³è½¬åˆ°æœ€åä¸€é¡µ
        }

        saveData(); // ä¿å­˜æ•°æ®
        updateDisplay(); // æ›´æ–°æ˜¾ç¤º
    }

    // åœ¨addRecordå‡½æ•°ä¸­é‡ç½®é¡µç 
    function addRecord() {
        const type = document.getElementById('recordType').value; // è·å–è®°å½•ç±»å‹
        const amount = parseFloat(document.getElementById('amount').value); // è·å–é‡‘é¢
        const category = document.getElementById('category').value; // è·å–åˆ†ç±»
        const date = document.getElementById('recordDate').value; // è·å–æ—¥æœŸ
        const description = document.getElementById('description').value.trim(); // è·å–å¤‡æ³¨

        if (!amount || amount <= 0) { // éªŒè¯é‡‘é¢
            alert('è¯·è¾“å…¥æœ‰æ•ˆçš„é‡‘é¢'); // æç¤ºè¾“å…¥æœ‰æ•ˆé‡‘é¢
            return;
        }

        if (!date) { // éªŒè¯æ—¥æœŸ
            alert('è¯·é€‰æ‹©æ—¥æœŸ'); // æç¤ºé€‰æ‹©æ—¥æœŸ
            return;
        }

        const record = { // åˆ›å»ºè®°å½•å¯¹è±¡
            id: Date.now(), // ä½¿ç”¨æ—¶é—´æˆ³ä½œä¸ºID
            type: type, // è®°å½•ç±»å‹
            amount: amount, // é‡‘é¢
            category: category, // åˆ†ç±»
            date: date, // æ—¥æœŸ
            description: description, // å¤‡æ³¨
            timestamp: new Date().toISOString() // æ—¶é—´æˆ³
        };

        records.unshift(record); // æ·»åŠ åˆ°è®°å½•æ•°ç»„å¼€å¤´
        currentPage = 1; // æ·»åŠ æ–°è®°å½•åè·³è½¬åˆ°ç¬¬ä¸€é¡µ
        saveData(); // ä¿å­˜æ•°æ®

        document.getElementById('amount').value = ''; // æ¸…ç©ºé‡‘é¢è¾“å…¥æ¡†
        document.getElementById('description').value = ''; // æ¸…ç©ºå¤‡æ³¨è¾“å…¥æ¡†

        updateDisplay(); // æ›´æ–°æ˜¾ç¤º
        alert('è®°å½•æ·»åŠ æˆåŠŸï¼'); // æç¤ºæ·»åŠ æˆåŠŸ
    }

    // ========== æœç´¢ç›¸å…³å˜é‡ ==========
    let searchKeyword = ''; // æœç´¢å…³é”®è¯
    let isSearchMode = false; // æ˜¯å¦å¤„äºæœç´¢æ¨¡å¼
    let searchResults = []; // æœç´¢ç»“æœ

    // å¤„ç†æœç´¢è¾“å…¥ï¼ˆæ”¯æŒå›è½¦æœç´¢ï¼‰
    function handleSearchInput(event) {
        if (event.key === 'Enter') { // å¦‚æœæŒ‰ä¸‹å›è½¦é”®
            performSearch(); // æ‰§è¡Œæœç´¢
            event.target.blur(); // ç§»é™¤ç„¦ç‚¹
        }
    }

    // æ‰§è¡Œæœç´¢å‡½æ•°
    function performSearch() {
        const input = document.getElementById('searchInput').value.trim(); // è·å–æœç´¢è¾“å…¥
        searchKeyword = input; // ä¿å­˜æœç´¢å…³é”®è¯

        if (!searchKeyword) { // å¦‚æœæœç´¢å…³é”®è¯ä¸ºç©º
            clearSearch(); // æ¸…é™¤æœç´¢
            return;
        }

        isSearchMode = true; // è¿›å…¥æœç´¢æ¨¡å¼
        searchRecords(); // æœç´¢è®°å½•
    }

    // ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æœç´¢è®°å½•
    function searchRecords() {
        try {
            // ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼å®ç°æ¨¡ç³Šæœç´¢
            const regex = new RegExp(searchKeyword, 'i'); // åˆ›å»ºæ­£åˆ™è¡¨è¾¾å¼ï¼Œä¸åŒºåˆ†å¤§å°å†™

            // æœç´¢åŒ¹é…çš„è®°å½•
            searchResults = records.filter(record => {
                // æœç´¢å¤‡æ³¨å­—æ®µ
                const matchDescription = record.description && regex.test(record.description);
                // æœç´¢åˆ†ç±»å­—æ®µ
                const matchCategory = regex.test(record.category);
                // è¿”å›åŒ¹é…çš„è®°å½•
                return matchDescription || matchCategory;
            });

            if (searchResults.length === 0) { // å¦‚æœæ²¡æœ‰æœç´¢ç»“æœ
                showNoResults(); // æ˜¾ç¤ºæ— ç»“æœ
                return;
            }

            // æ˜¾ç¤ºæœç´¢ç»“æœ
            displaySearchResults(); // æ˜¾ç¤ºæœç´¢ç»“æœ

        } catch (error) { // æ•è·å¼‚å¸¸
            console.error('æœç´¢å‡ºé”™ï¼š', error);
            alert('æœç´¢è¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯');
        }
    }

    // æ˜¾ç¤ºæ— æœç´¢ç»“æœ
    function showNoResults() {
        const container = document.getElementById('recordsContainer'); // è·å–è®°å½•å®¹å™¨
        container.innerHTML = `
        <div class="empty-state">
            <i class="fas fa-search" style="font-size: 48px; margin-bottom: 15px; color: #ccc;"></i>
            <p>æ²¡æœ‰æ‰¾åˆ°åŒ…å« "<strong>${searchKeyword}</strong>" çš„è®°å½•</p>
            <button onclick="clearSearch()" style="margin-top: 10px; padding: 8px 16px; background: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer;">
                è¿”å›å…¨éƒ¨è®°å½•
            </button>
        </div>
    `;
    }

    // æ˜¾ç¤ºæœç´¢ç»“æœ
    function displaySearchResults() {
        const container = document.getElementById('recordsContainer'); // è·å–è®°å½•å®¹å™¨

        const categoryNames = { // åˆ†ç±»åç§°æ˜ å°„
            'food': 'é¤é¥®', 'transport': 'äº¤é€š', 'shopping': 'è´­ç‰©',
            'housing': 'ä½æˆ¿', 'entertainment': 'å¨±ä¹', 'salary': 'å·¥èµ„',
            'investment': 'æŠ•èµ„', 'other': 'å…¶ä»–'
        };

        let html = ''; // HTMLå­—ç¬¦ä¸²

        // æ˜¾ç¤ºæœç´¢ç»“æœæ ‡é¢˜
        html += `
        <div style="padding: 15px 20px; background: #e8f5e9; border-bottom: 1px solid #4CAF50;">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <i class="fas fa-search" style="color: #4CAF50; margin-right: 8px;"></i>
                    <span style="color: #2E7D32; font-weight: 500;">æœç´¢åˆ° ${searchResults.length} æ¡è®°å½•</span>
                    <span style="color: #666; margin-left: 10px; font-size: 13px;">å…³é”®è¯: ${searchKeyword}</span>
                </div>
                <button onclick="clearSearch()" style="padding: 4px 12px; background: white; color: #4CAF50; border: 1px solid #4CAF50; border-radius: 4px; cursor: pointer; font-size: 12px;">
                    æ¸…é™¤æœç´¢
                </button>
            </div>
        </div>
    `;

        // æ˜¾ç¤ºæœç´¢ç»“æœ
        searchResults.forEach(record => {
            const category = categoryNames[record.category] || record.category;
            const typeClass = record.type === 'income' ? 'income-type' : 'expense-type';
            const typeSign = record.type === 'income' ? '+' : '-';
            const amountColor = record.type === 'income' ? '#4CAF50' : '#F44336';

            // é«˜äº®æ˜¾ç¤ºåŒ¹é…çš„æ–‡æœ¬
            let highlightedDescription = record.description || '';
            let highlightedCategory = category;

            try {
                const regex = new RegExp(searchKeyword, 'gi'); // å…¨å±€ä¸åŒºåˆ†å¤§å°å†™
                if (record.description) {
                    highlightedDescription = record.description.replace(regex, match =>
                        `<span style="background-color: #fff9c4; padding: 1px 3px; border-radius: 2px; font-weight: bold;">${match}</span>`
                    );
                }
                highlightedCategory = category.replace(regex, match =>
                    `<span style="background-color: #fff9c4; padding: 1px 3px; border-radius: 2px; font-weight: bold;">${match}</span>`
                );
            } catch (e) {
                // ä¿æŒåŸæ ·
            }

            html += `
            <div class="record-item">
                <div class="record-type ${typeClass}">
                    ${record.type === 'income' ? 'æ”¶' : 'æ”¯'}
                </div>
                <div class="record-info">
                    <div class="record-category">${highlightedCategory}</div>
                    <div class="record-meta">
                        ${record.date} ${record.description ? 'Â· ' + highlightedDescription : ''}
                    </div>
                </div>
                <div class="record-amount" style="color: ${amountColor}">
                    ${typeSign}Â¥ ${record.amount.toFixed(2)}
                </div>
                <button class="delete-btn" onclick="deleteRecord(${record.id})">
                    <i class="fas fa-trash"></i>
                </button>
            </div>
        `;
        });

        // æ·»åŠ è¿”å›å…¨éƒ¨è®°å½•æŒ‰é’®
        html += `
        <div style="padding: 15px 20px; text-align: center; border-top: 1px solid #eee;">
            <button onclick="clearSearch()" style="padding: 8px 20px; background: #f5f5f5; color: #666; border: 1px solid #ddd; border-radius: 4px; cursor: pointer;">
                <i class="fas fa-arrow-left" style="margin-right: 5px;"></i>è¿”å›å…¨éƒ¨è®°å½•
            </button>
        </div>
    `;

        container.innerHTML = html; // æ›´æ–°å®¹å™¨å†…å®¹
    }

    // æ¸…é™¤æœç´¢å‡½æ•°
    function clearSearch() {
        searchKeyword = ''; // æ¸…ç©ºæœç´¢å…³é”®è¯
        isSearchMode = false; // é€€å‡ºæœç´¢æ¨¡å¼
        searchResults = []; // æ¸…ç©ºæœç´¢ç»“æœ

        document.getElementById('searchInput').value = ''; // æ¸…ç©ºæœç´¢è¾“å…¥æ¡†

        // æ¢å¤æ˜¾ç¤ºæ­£å¸¸è®°å½•
        updateDisplay(); // è°ƒç”¨åŸæœ‰çš„æ›´æ–°æ˜¾ç¤ºå‡½æ•°
    }

    // ä¿®æ”¹deleteRecordå‡½æ•°ï¼Œæ”¯æŒåœ¨æœç´¢æ¨¡å¼ä¸‹åˆ é™¤
    function deleteRecord(id) {
        if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡è®°å½•å—ï¼Ÿ')) return;

        // åˆ é™¤è®°å½•
        records = records.filter(record => record.id !== id);

        // å¦‚æœåœ¨æœç´¢æ¨¡å¼ä¸‹ï¼Œæ›´æ–°æœç´¢ç»“æœ
        if (isSearchMode && searchKeyword) {
            searchResults = searchResults.filter(record => record.id !== id);

            if (searchResults.length === 0) {
                showNoResults(); // æ˜¾ç¤ºæ— ç»“æœ
            } else {
                displaySearchResults(); // é‡æ–°æ˜¾ç¤ºæœç´¢ç»“æœ
            }
        }

        // è°ƒæ•´åˆ†é¡µ
        const totalPages = Math.ceil(records.length / recordsPerPage);
        if (currentPage > totalPages && currentPage > 1) {
            currentPage = totalPages;
        }

        saveData();
        if (!isSearchMode) {
            updateDisplay(); // åªåœ¨éæœç´¢æ¨¡å¼ä¸‹æ›´æ–°æ˜¾ç¤º
        }
    }

    // é€€å‡ºç™»å½•
    function logout() {
        if (confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ')) {
            localStorage.removeItem('currentUser');
            window.location.href = 'index.html';
        }
    }
</script>
</body>
</html>